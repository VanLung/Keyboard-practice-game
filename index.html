<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Master - Team Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Patrick+Hand&display=swap');

        :root {
            --team1-color: #FF9AA2;
            --team2-color: #FFB7B2;
            --team3-color: #FFDAC1;
            --team4-color: #E2F0CB;
        }

        * {
            font-family: 'Patrick Hand', cursive;
        }

        body {
            background-color: #f0f9ff;
            background-image: url('https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9f6a08c9-a973-4973-9cc4-357e897d5f95.png');
            background-size: cover;
            background-attachment: fixed;
        }

        .title {
            font-family: 'Gochi Hand', cursive;
            color: #3b82f6;
            text-shadow: 2px 2px 0px #fff;
        }

        .key {
            transition: all 0.1s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }

        .key.active {
            transform: translateY(4px);
            box-shadow: 0 1px 2px -1px rgba(0, 0, 0, 0.2);
            filter: brightness(0.9);
        }

        .correct {
            background-color: #86efac !important;
        }

        .wrong {
            background-color: #fca5a5 !important;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .team-1 {
            background-color: var(--team1-color);
        }

        .team-2 {
            background-color: var(--team2-color);
        }

        .team-3 {
            background-color: var(--team3-color);
        }

        .team-4 {
            background-color: var(--team4-color);
        }

        .celebrate {
            animation: celebrate 2s infinite;
        }

        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .progress-bar {
            transition: width 0.3s ease;
        }

        .correct-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-4">
    <div class="absolute inset-0 bg-white bg-opacity-70 z-0" style="outline: rgb(0, 0, 0) dotted 3px; outline-offset: 1px;"></div>

    <div class="relative z-10 w-full max-w-4xl">
        <!-- Mode Selection -->
        <div id="modeSelection" class="text-center mb-8 p-6 bg-white rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold mb-6">Chọn chế độ</h2>
            <div class="flex justify-center gap-4">
                <button onclick="showTeacherMode()" class="px-6 py-3 bg-blue-500 text-white rounded-lg text-xl hover:bg-blue-600">
                    Giáo viên
                </button>
                <button onclick="showStudentMode()" class="px-6 py-3 bg-green-500 text-white rounded-lg text-xl hover:bg-green-600">
                    Học sinh
                </button>
            </div>
        </div>

        <!-- Header -->
        <header class="text-center mb-8 hidden" id="gameHeader">
            <h1 class="title text-5xl md:text-6xl mb-2">Typing Master</h1>
            <p class="text-xl">Team Challenge - Who's Faster?</p>
        </header>

        <!-- Game Area -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 relative overflow-hidden">
            <!-- Team Selection -->
            <div id="teamSetup" class="mb-8 hidden">
                <h2 class="text-2xl font-bold mb-4 text-center">Thiết lập đội chơi</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="team-option p-4 rounded-lg">
                        <label class="block text-lg font-semibold mb-2">Số đội chơi</label>
                        <div class="flex justify-center gap-2">
                            <button onclick="setTeamCount(2)" class="px-4 py-2 bg-blue-100 rounded-lg hover:bg-blue-200">2 Đội</button>
                            <button onclick="setTeamCount(3)" class="px-4 py-2 bg-blue-100 rounded-lg hover:bg-blue-200">3 Đội</button>
                            <button onclick="setTeamCount(4)" class="px-4 py-2 bg-blue-100 rounded-lg hover:bg-blue-200">4 Đội</button>
                        </div>
                    </div>
                    <div class="time-option p-4 rounded-lg">
                        <label class="block text-lg font-semibold mb-2">Thời gian (giây)</label>
                        <select id="gameTime" class="w-full p-2 border rounded-lg">
                            <option value="30">30 giây</option>
                            <option value="60" selected>60 giây</option>
                            <option value="90">90 giây</option>
                            <option value="120">120 giây</option>
                        </select>
                    </div>
                </div>

                <div id="teamNamesContainer" class="hidden grid-cols-1 md:grid-cols-2 gap-4 mb-6"></div>

                <div class="text-center">
                    <div id="gameCodeDisplay" class="mb-4 hidden">
                        <p class="font-bold">Mã trò chơi:</p>
                        <p id="gameCodeValue" class="text-2xl font-mono bg-gray-100 p-2 rounded"></p>
                        <p class="text-sm text-gray-600">Học sinh nhập mã này để tham gia</p>
                    </div>
                    <button id="startGameBtn" onclick="startGame(false)"
                        class="px-6 py-3 bg-green-500 text-white rounded-lg text-xl hover:bg-green-600 hidden">
                        BẮT ĐẦU CUỘC CHIẾN!
                    </button>
                </div>
            </div>

            <!-- Game Screen (Student Mode - Simplified for Single Player) -->
            <div id="studentSetup" class="hidden bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 text-center">Tham gia trò chơi</h2>
                <div class="mb-4">
                    <label class="block text-lg font-semibold mb-2">Tên của bạn</label>
                    <input type="text" id="studentName" class="w-full p-3 border rounded-lg text-center text-xl"
                           placeholder="Nhập tên của bạn">
                </div>
                <div class="mb-4">
                    <label class="block text-lg font-semibold mb-2">Mã trò chơi</label>
                    <input type="text" id="studentGameCode" class="w-full p-3 border rounded-lg text-center text-xl"
                           placeholder="Nhập mã từ giáo viên" oninput="getAvailableTeams()">
                </div>
                <div class="mb-4">
                    <label class="block text-lg font-semibold mb-2">Chọn đội</label>
                    <select id="studentTeamSelect" class="w-full p-3 border rounded-lg text-center text-xl">
                        <option value="">-- Chọn đội --</option>
                    </select>
                </div>
                <button onclick="startSinglePlayerGame()" class="w-full py-3 bg-green-500 text-white rounded-lg text-xl hover:bg-green-600">
                    Bắt đầu chơi đơn
                </button>
            </div>

            <!-- Game Screen -->
            <div id="gameScreen" class="hidden">
                <!-- Additional content and game mechanics go here... -->
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-4">Hướng dẫn chơi</h2>
            <ol class="list-decimal pl-5 space-y-2">
                <li>Chọn số đội chơi và đặt tên cho mỗi đội (chế độ Giáo viên)</li>
                <li>Hoặc nhập tên và chọn đội để chơi đơn (chế độ Học sinh)</li>
                <li>Gõ đúng để ghi điểm, gõ sai sẽ bị trừ thời gian</li>
                <li>Đội nào ghi được nhiều điểm nhất sẽ thắng! (hoặc bạn ghi được nhiều điểm nhất trong chơi đơn)</li>
            </ol>
        </div>
    </div>

    <script>
        // Game state and local storage setup
        const gameState = {
            teams: [],
            currentTeamIndex: 0,
            isPlaying: false,
            timeLeft: 60,
            currentWord: '',
            currentIndex: 0,
            score: {},
            playerScores: {},
            gameId: null,
            availableTeamsForStudent: [],
            lastStudentName: '',
            lastStudentGameCode: '',
            lastStudentTeamName: ''
        };

        // Save game settings to localStorage (teacher's side)
        function saveGameSettings() {
            const gameCode = gameState.gameId;
            const teams = gameState.teams;
            localStorage.setItem('gameCode', gameCode);
            localStorage.setItem('teams', JSON.stringify(teams));
        }

        // Load game settings for student from localStorage
        function loadGameSettings() {
            const gameCode = localStorage.getItem('gameCode');
            const teams = JSON.parse(localStorage.getItem('teams'));

            if (gameCode && teams) {
                populateTeamSelect(teams);
            } else {
                alert("Mã trò chơi hoặc đội không hợp lệ.");
            }
        }

        // Populate team dropdown for student
        function populateTeamSelect(teams) {
            const studentTeamSelect = document.getElementById('studentTeamSelect');
            studentTeamSelect.innerHTML = '<option value="">-- Chọn đội --</option>';
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.name;
                option.textContent = team.name;
                studentTeamSelect.appendChild(option);
            });
        }

        // Get available teams for student
        function getAvailableTeams() {
            const gameCode = document.getElementById('studentGameCode').value.trim();
            if (gameCode === localStorage.getItem('gameCode')) {
                const teams = JSON.parse(localStorage.getItem('teams'));
                populateTeamSelect(teams);
            }
        }

        // Start the game in single-player mode
        function startSinglePlayerGame() {
            const gameCode = document.getElementById('studentGameCode').value.trim();
            const selectedTeam = document.getElementById('studentTeamSelect').value;

            if (gameCode === localStorage.getItem('gameCode') && selectedTeam) {
                gameState.gameId = gameCode;
                gameState.teams = [{ name: selectedTeam, score: 0 }];
                gameState.score = { [selectedTeam]: 0 };
                gameState.playerScores = { [selectedTeam]: {} };

                // Start the game logic...
            } else {
                alert('Mã trò chơi hoặc đội không hợp lệ.');
            }
        }

        // Teacher mode to set up the game
        function showTeacherMode() {
            gameState.gameId = Math.random().toString(36).substring(2, 6).toUpperCase();
            document.getElementById('gameCodeValue').textContent = gameState.gameId;

            // Allow teacher to set up teams
            gameState.teams = [];
            saveGameSettings();
        }

        // Show student mode and load available teams
        function showStudentMode() {
            loadGameSettings();
        }
    </script>
</body>
</html>
